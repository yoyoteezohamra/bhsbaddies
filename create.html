<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Your Ranking - BHS Baddies</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCzT0n2tF_E8p5amHHyPErhbe0lOMlP7us",
    authDomain: "bhsbaddies.firebaseapp.com",
    projectId: "bhsbaddies",
    storageBucket: "bhsbaddies.firebasestorage.app",
    messagingSenderId: "199970593259",
    appId: "1:199970593259:web:30f05fb927f92206c161ae"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
</head>
<body>

<header>
  <div class="title-section">
    <h1><a href="index.html">BHS Baddies</a></h1>
    <div class="grade-links">
      <a href="9.html">9th</a>
      <a href="10.html">10th</a>
      <a href="11.html">11th</a>
      <a href="12.html">12th</a>
      <a href="create.html" class="btn">Create Your Ranking</a>
    </div>
  </div>
</header>

<main>
  <h2>Create Your Ranking</h2>

  <label for="name">Name:</label>
  <input type="text" id="name" placeholder="Enter your name">

  <label for="grade">Select your grade:</label>
  <select id="grade">
    <option value="9">9th Grade</option>
    <option value="10">10th Grade</option>
    <option value="11">11th Grade</option>
    <option value="12">12th Grade</option>
  </select>

  <h3>Baddies:</h3>
  <div id="baddiesContainer"></div>
  <button type="button" id="addBaddieBtn" class="btn2">Add More</button>

  <h3>Comment:</h3>
  <textarea id="comment" placeholder="Add your comment here..." rows="4"></textarea>

  <button type="button" id="saveBtn" class="btn2">Save Ranking</button>
</main>

<script>
const baddiesContainer = document.getElementById('baddiesContainer');
const addBaddieBtn = document.getElementById('addBaddieBtn');
const saveBtn = document.getElementById('saveBtn');

function addBaddieField(value='') {
  const div = document.createElement('div');
  div.className = 'baddie-row';
  div.innerHTML = `
    <input type="text" placeholder="Baddie name" value="${value}">
    <button type="button" class="remove-player">Remove</button>
  `;
  baddiesContainer.appendChild(div);

  div.querySelector('.remove-player').addEventListener('click', () => div.remove());
}

// Start with 3 baddie fields
for(let i=0;i<3;i++) addBaddieField();

// Add more on button click
addBaddieBtn.addEventListener('click', () => addBaddieField());

// Save ranking to Firestore
saveBtn.addEventListener('click', async () => {
  const name = document.getElementById('name').value.trim();
  const grade = document.getElementById('grade').value;
  const comment = document.getElementById('comment').value.trim();
  const baddieInputs = baddiesContainer.querySelectorAll('input');
  const baddies = Array.from(baddieInputs).map(i => i.value.trim()).filter(p => p !== '');
  
  if(!name){ alert('Please enter your name'); return; }
  if(baddies.length === 0){ alert('Please add at least one baddie'); return; }

  const newRanking = { username: name, grade, players: baddies, comment, timestamp: Date.now() };

  try {
    await db.collection("rankings").add(newRanking);
    alert('Ranking saved!');
    window.location.href = `${grade}.html`;
  } catch (error) {
    console.error("Error saving ranking: ", error);
    alert('Error saving ranking, try again.');
  }
});
</script>

</body>
</html>
