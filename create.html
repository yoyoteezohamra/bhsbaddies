<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Your Ranking - BHS Baddies</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h1><a href="index.html">BHS Baddies</a></h1>
  <div class="grade-links">
    <a href="9.html">9th</a>
    <a href="10.html">10th</a>
    <a href="11.html">11th</a>
    <a href="12.html">12th</a>
    <a href="create.html" class="btn">Create Your Ranking</a>
  </div>
</header>

<main>
  <h2>Create Your Ranking</h2>

  <form id="rankingForm">
    <label for="name">Name:</label>
    <input id="name" name="name" type="text" placeholder="Enter your name" />

    <label for="grade">Select your grade:</label>
    <select id="grade" name="grade">
      <option value="9">9th Grade</option>
      <option value="10">10th Grade</option>
      <option value="11">11th Grade</option>
      <option value="12">12th Grade</option>
    </select>

    <label>Add Baddies:</label>
    <div id="baddiesContainer">
      <div class="baddie-row">
        <input class="baddie-input" type="text" placeholder="Baddie name" />
        <button type="button" class="remove-player">Remove</button>
      </div>
      <div class="baddie-row">
        <input class="baddie-input" type="text" placeholder="Baddie name" />
        <button type="button" class="remove-player">Remove</button>
      </div>
      <div class="baddie-row">
        <input class="baddie-input" type="text" placeholder="Baddie name" />
        <button type="button" class="remove-player">Remove</button>
      </div>
    </div>

    <button id="addBaddieBtn" type="button" class="btn2">Add More</button>

    <label for="comment">Comment:</label>
    <textarea id="comment" name="comment" rows="4" placeholder="Add your comment here..."></textarea>

    <button id="saveBtn" type="submit" class="btn2">Save Ranking</button>
  </form>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzT0n2tF_E8p5amHHyPErhbe0lOMlP7us",
  authDomain: "bhsbaddies.firebaseapp.com",
  projectId: "bhsbaddies",
  storageBucket: "bhsbaddies.appspot.com",
  messagingSenderId: "199970593259",
  appId: "1:199970593259:web:30f05fb927f92206c161ae"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const baddiesContainer = document.getElementById('baddiesContainer');
const addBaddieBtn = document.getElementById('addBaddieBtn');

function createBaddieRow(value = '') {
  const row = document.createElement('div');
  row.className = 'baddie-row';
  row.innerHTML = `
    <input class="baddie-input" type="text" placeholder="Baddie name" value="${value}" />
    <button type="button" class="remove-player">Remove</button>
  `;
  const removeBtn = row.querySelector('.remove-player');
  removeBtn.addEventListener('click', () => row.remove());
  return row;
}

addBaddieBtn.addEventListener('click', () => {
  baddiesContainer.appendChild(createBaddieRow(''));
});

document.querySelectorAll('#baddiesContainer .remove-player').forEach(btn => {
  btn.addEventListener('click', e => e.target.closest('.baddie-row').remove());
});

const form = document.getElementById('rankingForm');
form.addEventListener('submit', async e => {
  e.preventDefault();

  const name = document.getElementById('name').value.trim();
  const grade = document.getElementById('grade').value;
  const comment = document.getElementById('comment').value.trim();
  const baddieInputs = Array.from(document.querySelectorAll('.baddie-input'));
  const baddies = baddieInputs.map(i => i.value.trim()).filter(Boolean);

  if (!name) return alert('Please enter your name');
  if (baddies.length === 0) return alert('Please add at least one baddie');

  const docData = { name, grade, baddies, comment, createdAt: serverTimestamp() };

  try {
    await addDoc(collection(db, 'rankings'), docData);
    alert('Ranking saved!');
    window.location.href = `${grade}.html`;
  } catch (err) {
    console.error(err);
    alert('Error saving ranking â€” try again.');
  }
});
</script>
</body>
</html>
