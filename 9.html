<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9th Grade Rankings - BHS Baddies</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h1><a href="index.html">BHS Baddies</a></h1>
  <div class="grade-links">
    <a href="9.html">9th</a>
    <a href="10.html">10th</a>
    <a href="11.html">11th</a>
    <a href="12.html">12th</a>
    <a href="create.html" class="btn">Create Your Ranking</a>
  </div>
</header>

<main>
  <h2>9th Grade Rankings</h2>
  <div id="rankingsContainer">Loading...</div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzT0n2tF_E8p5amHHyPErhbe0lOMlP7us",
  authDomain: "bhsbaddies.firebaseapp.com",
  projectId: "bhsbaddies",
  storageBucket: "bhsbaddies.appspot.com",
  messagingSenderId: "199970593259",
  appId: "1:199970593259:web:30f05fb927f92206c161ae"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("rankingsContainer");

async function loadRankings() {
  try {
    const q = query(collection(db, "rankings"), where("grade", "==", "9"), orderBy("createdAt", "desc"));
    const snapshot = await getDocs(q);
    container.innerHTML = "";

    if (snapshot.empty) {
      container.innerHTML = "<p>No rankings yet.</p>";
      return;
    }

    snapshot.forEach(doc => {
      const data = doc.data();
      const card = document.createElement("div");
      card.className = "ranking-card";
      card.innerHTML = `
        <h3>${escapeHtml(data.name)}'s Rankings</h3>
        <ol>${data.baddies.map(b => `<li>${escapeHtml(b)}</li>`).join("")}</ol>
        ${data.comment ? `<div class="comment">${escapeHtml(data.comment)}</div>` : ""}
      `;
      container.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    container.innerText = "Error loading rankings.";
  }
}

function escapeHtml(s) {
  return s?.replace(/[&<>"']/g, c => ({
    "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
  }[c])) || "";
}

loadRankings();
</script>
</body>
</html>
