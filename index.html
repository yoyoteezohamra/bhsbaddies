<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BHS Baddies</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header>
  <h1><a href="index.html">BHS Baddies</a></h1>
  <div class="grade-links">
    <a href="9.html">9th</a>
    <a href="10.html">10th</a>
    <a href="11.html">11th</a>
    <a href="12.html">12th</a>
    <a href="create.html" class="btn">Create Your Ranking</a>
  </div>
</header>

<main>
  <div class="description">
    <h2>Welcome to BHS Baddies!</h2>
    <p>Have fun ranking! You know what they say, 1st is the worst, second is the best...</p>
    <a href="create.html" class="btn2">Create Your Ranking</a>
  </div>

  <div class="latest-rankings">
    <h2>Latest Rankings</h2>
    <div id="latestRankings"></div>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCzT0n2tF_E8p5amHHyPErhbe0lOMlP7us",
  authDomain: "bhsbaddies.firebaseapp.com",
  projectId: "bhsbaddies",
  storageBucket: "bhsbaddies.appspot.com",
  messagingSenderId: "199970593259",
  appId: "1:199970593259:web:30f05fb927f92206c161ae"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const latestContainer = document.getElementById("latestRankings");

async function loadLatest() {
  latestContainer.innerHTML = "<p>Loading...</p>";
  try {
    const q = query(collection(db, "rankings"), orderBy("createdAt", "desc"), limit(5));
    const snapshot = await getDocs(q);
    latestContainer.innerHTML = "";

    if (snapshot.empty) {
      latestContainer.innerHTML = "<p>No rankings yet.</p>";
      return;
    }

    snapshot.forEach(doc => {
      const d = doc.data();
      const card = document.createElement("div");
      card.className = "ranking-card";
      card.innerHTML = `
        <h4>${escapeHtml(d.name)} (${escapeHtml(d.grade)}th)</h4>
        <ol>${d.baddies.map(b => `<li>${escapeHtml(b)}</li>`).join("")}</ol>
        ${d.comment ? `<div class="comment">${escapeHtml(d.comment)}</div>` : ""}
      `;
      latestContainer.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    latestContainer.innerHTML = "<p>Error loading rankings.</p>";
  }
}

function escapeHtml(s) {
  return s?.replace(/[&<>"']/g, c => ({
    "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;"
  }[c])) || "";
}

loadLatest();
</script>
</body>
</html>
